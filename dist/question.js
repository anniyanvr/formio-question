angular.module("formio.question",["formio","nvd3"]).directive("formioQuestion",function(){var t='<div class="formio-question-form"></div><button ng-if="previewResults" class="btn btn-success btn-sm" ng-click="showAnalytics()">Results</button><button class="btn btn-primary btn-sm" ng-click="save()">Submit</button>';return{restrict:"E",replace:!0,template:'<div><i ng-show="!questionLoaded" id="formio-loading" style="font-size: 2em;" class="glyphicon glyphicon-refresh glyphicon-spin"></i><div ng-repeat="alert in formioAlerts" class="alert alert-{{ alert.type }}" role="alert">{{ alert.message }}</div><div class="formio-question">'+t+"</div></div>",scope:{src:"=",question:"=",submission:"=",previewResults:"=",updateAnswer:"=",chartOptions:"="},link:function(t,n){t.questionLoaded=!1,t.questionElement=angular.element(".formio-question",n)},controller:["$scope","$compile","$element","Formio","FormioScope","$http","FormioUtils",function(n,e,o,s,i,r,a){n.formio=new s(n.src),n._chartOptions=n.chartOptions||{chart:{type:"pieChart",height:500,x:function(t){return t.key},y:function(t){return t.y},showLabels:!0,duration:500,labelThreshold:.01,labelSunbeamLayout:!0,legend:{margin:{top:5,right:35,bottom:5,left:0}}}},n.page={},n.form={},r.get(n.src).then(function(o){o=o.data,n.form=o,n.showAnalytics=function(){r.get(n.src+"/submission?limit=4294967295").then(function(t){t=t.data;var o={};_(t).map("data."+n.question).value().forEach(function(t){o[t]=o[t]+1||1}),n.chartData=_(o).map(function(t,n){return{key:n,y:t}}).value(),n.questionElement.html(e('<span>Selection:{{results}}</span><br><nvd3 options="_chartOptions" data="chartData"></nvd3><button ng-if="updateAnswer" class="btn btn-success btn-sm" ng-click="resetQuestion()">Question</button>')(n))})["catch"](function(t){console.error(t)})},n.showQuestion=function(){n.updateAnswer||n.showAnalytics(),n.page.components=[a.getComponent(o.components,n.question)];var t=angular.element(document.createElement("formio"));angular.element(document.getElementsByClassName("formio-question-form")).html(e(t.attr({form:"page",submission:"submission"}))(n)),n.questionLoaded=!0,n.formioAlerts=[]},n.showQuestion(),n.resetQuestion=function(){n.questionElement.html(e(t)(n)),n.showQuestion()},n.save=function(){var t=_.has(n.submission,"_id")?"put":"post",e="post"===t?n.src+"/submission":n.src+"/submission/"+n.submission._id;r[t](e,n.submission).then(function(){n.showAnalytics()})["catch"](function(t){console.error(t)})}})["catch"](function(t){console.error(t)})}]}});