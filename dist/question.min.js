!function t(e,n,a){function s(i,r){if(!n[i]){if(!e[i]){var l="function"==typeof require&&require;if(!r&&l)return l(i,!0);if(o)return o(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[i]={exports:{}};e[i][0].call(c.exports,function(t){var n=e[i][1][t];return s(n?n:t)},c,c.exports,t,e,n,a)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<a.length;i++)s(a[i]);return s}({1:[function(t,e,n){angular.module("formio.question",["formio","nvd3"]).directive("formioQuestion",function(){var t='<div class="formio-question-form"></div><button ng-if="previewResults && (view === \'question\')" class="btn btn-success btn-sm" ng-click="showAnalytics()">Results</button><button ng-if="updateAnswer && (view === \'analytics\')" class="btn btn-success btn-sm" ng-click="resetQuestion()">Question</button><button ng-if="view === \'question\'" class="btn btn-primary btn-sm pull-right" ng-click="save()" ng-disabled="disabledInput">Submit</button>';return{restrict:"E",replace:!0,template:'<div><i ng-show="!questionLoaded" id="formio-loading" style="font-size: 2em;" class="glyphicon glyphicon-refresh glyphicon-spin"></i><div ng-repeat="alert in formioAlerts" class="alert alert-{{ alert.type }}" role="alert">{{ alert.message }}</div><div class="formio-question">'+t+"</div></div>",scope:{src:"=",question:"=",child:"=",form:"=",submissions:"=",submission:"=",previewResults:"=",updateAnswer:"=",chart:"=",chartAdvanced:"=",chartDataCustomizer:"=",waitForPromise:"=",disabledInput:"=",controller:"="},link:function(t,e,n,a,s){t.questionLoaded=!1,t.questionElement=angular.element(".formio-question",e),t.questionElementForm=angular.element(".formio-question-form",e)},controller:["$scope","$compile","$element","Formio","FormioScope","$http","FormioUtils","$q","$timeout",function(e,n,a,s,o,i,r,l,u){var c=["table","pie","word cloud","list","frequency"];e.views={question:"question",analytics:"analytics"},e.view=e.views.question;var d=function(){return'<div class="row"><div class="col-md-12"><h3>Results</h3><table class="table table-hover table-condensed"><thead><tr><th>Answer</th><th>Count</th></tr></thead><tbody><tr ng-repeat="answer in data track by $index"><td>{{answer.label}}</td><td>{{answer.value}}</td></tr></tbody></table></div></div>'},m=function(){var t=_(e.data).map("value").value();return t=_.sum(t),e.graphCallback=function(n){function a(t){d3.select(s).append("svg").attr("width",i.size()[0]).attr("height",i.size()[1]).append("g").attr("transform","translate("+i.size()[0]/2+","+i.size()[1]/2+")").selectAll("text").data(t).enter().append("text").style("font-size",function(t){return t.size+"px"}).style("font-family","Impact").style("fill",function(t,e){return o(e)}).attr("text-anchor","middle").attr("transform",function(t){return"translate("+[t.x,t.y]+")rotate("+t.rotate+")"}).text(function(t){return t.text}),n()}var s=e.questionElementForm.find("#wordcloud")[0],o=d3.scale.category20(),i=d3.layout.cloud().size([400,400]).words(e.data.map(function(e){return{text:e.label.toString(),size:e.value/t*150}})).padding(5).rotate(function(){return 90*~~(2*Math.random())}).font("Impact").fontSize(function(t){return t.size}).on("end",a);i.start()},'<div id="wordcloud"></div>'},v=function(){return'<div class="row"><div class="col-md-12"><h3>Results</h3><table class="table table-hover table-condensed"><thead><tr><th>Answer</th><th>Time</th></tr></thead><tbody><tr ng-repeat="answer in data track by $index"><td>{{answer.value}}</td><td>{{answer.created}}</td></tr></tbody></table></div></div>'},h=function(){return'<div class="row"><div class="col-md-12"><div class="row"><div class="col-md-6"><h3>Most Frequently Answered</h3><h1>{{data[0].label}}</h1><p class="lead">{{data[0].value}} / {{totalAnswers}} Answers<br>{{data.length}} Answer Choices</p></div><div class="col-md-6"><h3>Top 5 Answers</h3><div class="row" ng-repeat="answer in data | limitTo:5"><div class="col-md-12 col-sm-6 col-xs-6"><span class="pull-left">{{answer.label}}</span><span class="pull-right">{{answer.value}}</span></div><div class="col-md-12 col-sm-6 col-xs-6"><div class="progress"><div class="progress-bar progress-bar-info" style="width:{{(answer.value / totalAnswers)*100}}%">{{(answer.value / totalAnswers)*100}}%</div></div></div></div></div></div></div></div>'},f=function(t,n){return n=n||e.data,-1!==["table","word cloud","frequency"].indexOf(t)?_(n).map(function(t,e){return{label:e,value:t}}).orderBy("value","desc").value():-1!==["list"].indexOf(t)?_(n).orderBy("created","desc").map(function(t){return{question:t.data.key,value:t.data.value,created:new Date(t.created||0).toString()}}).value():-1!==["pie"].indexOf(t)?_(n).map(function(t,e){return{key:e,y:t}}).value():void 0},p=function(t){var n=function(t){e.data={};var n=e.child||e.question;return _(t).map("data."+n).value().forEach(function(t){t&&(e.data[t]=e.data[t]+1||1)}),e.data},a=function(t){var n=e.child||e.question;return e.data=_(t).map(function(t){return _.has(t,"data."+n)?(t.data={key:n,value:_.get(t,"data."+n)},t):void 0}).value(),e.data};if(e.chartAdvanced&&_.get(e.chartAdvanced,"chart.type")&&e.chartDataCustomizer)return e.data=e.chartDataCustomizer(e.data),'<nvd3 options="chartAdvanced" data="data"></nvd3>';var s=(e.chart||"table").toString().toLowerCase();return-1===c.indexOf(s)&&console.error("Unknown type given: "+s),"table"===s?(e.data=f(s,n(t)),d()):"frequency"===s?(e.data=f(s,n(t)),e.totalAnswers=_.sumBy(e.data,"value"),h()):"word cloud"===s?(e.data=f(s,n(t)),m()):"list"===s?(e.data=f(s,a(t)),v()):"pie"===s?(e.data=f(s,n(t)),e.options=e.chartAdvanced||{chart:{type:"pieChart",height:500,x:function(t){return t.key},y:function(t){return t.y},showLabels:!0,duration:500,labelThreshold:.01,labelSunbeamLayout:!0,legend:{margin:{top:5,right:35,bottom:5,left:0}}}},'<nvd3 options="options" data="data"></nvd3>'):void 0};e.showAnalytics=function(){e.view=e.views.analytics;var t=function(t){e.questionElementForm.html(n('<h3 class="fio-question-output">Answered: <span class="fio-question-answer">{{submission.data[(child || question)] || "N/A"}}</span></h3><br>'+p(t))(e)),e.graphCallback&&e.graphCallback(function(){e.graphCallback=null})};e.useSubmissionCache&&e.submissions?(t(e.submissions),e.$emit("showAnalytics")):e.src&&(e.useSubmissionCache=!0,i.get(e.src+"/submission?limit=4294967295").then(function(n){t(n.data),e.$emit("showAnalytics")})["catch"](function(t){console.error(t)}))},e.controller&&(e.controller.showAnalytics=e.showAnalytics),e.showQuestion=function(){if(e.view=e.views.question,e.questionLoaded=!0,e.formioAlerts=[],_.get(e,"submission.data."+(e.child||e.question))&&!e.updateAnswer)return e.showAnalytics();var t=angular.element(document.createElement("formio"));angular.element(e.questionElementForm).html(n(t.attr({form:"page",submission:"submission"}))(e)),e.$emit("showQuestion")},e.resetQuestion=function(){e.questionElementForm.html(n(t)(e)),e.showQuestion()},e.save=function(){var t=_.has(e.submission,"_id")?"put":"post",n="post"===t?e.src+"/submission":e.src+"/submission/"+e.submission._id;i[t](n,e.submission).then(function(t){e.$emit("questionSave",t),e.useSubmissionCache=!1,e.showAnalytics()})["catch"](function(t){console.error(t)})};var w=[];e.waitForPromise&&w.unshift(e.waitForPromise),e.$watch("chart",function(t,n){t!==n&&e.showAnalytics()}),l.all(w).then(function(){return u(function(){return e.form?e.form:e.src?i.get(e.src).then(function(t){return t.data})["catch"](function(t){console.error(t)}):void 0})}).then(function(t){e.page={components:[r.getComponent(t.components,e.question)]},e.showQuestion()})}]}})},{}]},{},[1]);